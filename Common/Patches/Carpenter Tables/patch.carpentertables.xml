<?xml version="1.0" encoding="utf-8" ?>
<Patch>
	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>[XND] Carpenter Tables (Continued)</li>
		</mods>
		<match Class="PatchOperationSequence">
			<success>Normal</success>
			<operations>
			
				<!-- Setup the work giver to make the Electric Table Saw inherit Recipes -->
				<li Class="PatchOperationAdd">
					<xpath>Defs/WorkGiverDef[defName="DoBillsCarpentersTable"]/fixedBillGiverDefs</xpath>
					<value>
						<li>TM3_ElectricTableSaw</li>
					</value>
				</li>
				
				<!-- Carperter's Table can be made out of stone too -->
				<li Class="PatchOperationAdd">
					<xpath>Defs/ThingDef[defName="TableCarpenter"]/stuffCategories</xpath>
					<value>
						<li>Stony</li>
					</value>
				</li>
				
				<!-- Carperter's Table works only at 80% efficiency to make Electric Table Saw desirable as it works at 100%-->
				<li Class="PatchOperationAdd">
					<xpath>Defs/ThingDef[defName="TableCarpenter"]/statBases</xpath>
					<value>
						<WorkTableWorkSpeedFactor>0.8</WorkTableWorkSpeedFactor>
					</value>
				</li>
				
				<!-- Carperter's Table is minifiable -->
				<li Class="PatchOperationConditional">
                    <xpath>Defs/ThingDef[defName="TableCarpenter"]/statBases</xpath>
                    <nomatch Class="PatchOperationAdd">
						<xpath>Defs/ThingDef[defName="TableCarpenter"]</xpath>
						<value>
							<statBases/>
						</value>
					</nomatch>

				<li Class="PatchOperationConditional">
                    <xpath>Defs/ThingDef[defName="TableCarpenter"]/statBases/minifiedDef</xpath>	
					<match Class="PatchOperationReplace">
                        <xpath>Defs/ThingDef[defName="TableCarpenter"]/statBases/minifiedDef</xpath>
                        <value>
							<minifiedDef>MinifiedThing</minifiedDef>
                        </value>
                    </match>

                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/ThingDef[defName="TableCarpenter"]/statBases</xpath>
                        <value>
							<minifiedDef>MinifiedThing</minifiedDef>
                        </value>
                    </nomatch>
                </li>
				
				<!-- Carpenter's Table has a ThingCategories BuildingsProduction -->
				<li Class="PatchOperationConditional">
                    <xpath>Defs/ThingDef[defName="TableCarpenter"]/thingCategories</xpath>
                    <nomatch Class="PatchOperationAdd">
						<xpath>Defs/ThingDef[defName="TableCarpenter"]</xpath>
						<value>
							<thingCategories/>
						</value>
					</nomatch>

				<li Class="PatchOperationConditional">
                    <xpath>Defs/ThingDef[defName="TableCarpenter"]/statBases/thingCategories</xpath>	
					<match Class="PatchOperationReplace">
                        <xpath>Defs/ThingDef[defName="TableCarpenter"]/statBases/thingCategories</xpath>
                        <value>
							<thingCategories>
								<li>BuildingsProduction</li>
							</thingCategories>
                        </value>
                    </match>

                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/ThingDef[defName="TableCarpenter"]/statBases</xpath>
                        <value>
							<thingCategories>
								<li>BuildingsProduction</li>
							</thingCategories>
                        </value>
                    </nomatch>
                </li>
				
				<!-- Carperter's Table gets linkable from VFE:Medieval2 -->
				<li Class="PatchOperationAdd" MayRequire="OskarPotocki.VFE.Medieval2">
					<xpath>Defs/ThingDef[defName="TableCarpenter"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
					<value>
						<li>VFEM2_ChiselRack</li>
						<li>VFEM2_ArtToolStand</li>
						<li>VFEM2_StonePolisher</li>
					</value>
				</li>
				
			</operations>
		</match>	
	</Operation>
</Patch>